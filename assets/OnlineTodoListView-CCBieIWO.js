import{o as r,c as u,a as o,t as w,u as z,i as A,r as i,w as B,g as V,v as D,j as L,n as T,F,d as M,h as N}from"./index-DY1loI5h.js";import{a as c}from"./axios-C8DqakIB.js";const S={class:"todoList_label"},P=["checked"],U=o("i",{class:"fa fa-times"},[o("button",{class:"deleteBtn"},"X")],-1),j=[U],E={__name:"TodoList",props:{content:String,status:Boolean,id:String},emits:["delete-todo","finished-todo"],setup(h,{emit:_}){const a=_,m=l=>{a("delete-todo",l)},k=l=>{a("finished-todo",l)};return(l,n)=>(r(),u("li",null,[o("label",S,[o("input",{class:"todoList_input",type:"checkbox",checked:h.status,onChange:n[0]||(n[0]=g=>k(h.id))},null,40,P),o("span",null,w(h.content),1)]),o("a",{onClick:n[1]||(n[1]=g=>m(h.id)),style:{height:"42px"}},j)]))}},I={id:"todoListPage",class:"bg-half"},O=o("a",null,[o("img",{class:"logoImg",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/logo.png",alt:"",style:{width:"45%"}})],-1),R={class:"todo_sm"},X={class:"conatiner todoListPage vhContainer"},q={class:"todoList_Content"},G={class:"inputBox"},H=o("i",{class:"fa fa-plus"},"+",-1),J=[H],K={key:0,class:"todoList_empty"},Q=o("p",null,"目前尚無待辦事項",-1),W=o("img",{src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/empty%201.png",alt:"",style:{width:"80%"}},null,-1),Y=[Q,W],Z={key:1,class:"todoList_list"},tt={class:"todoList_tab"},ot={class:"todoList_items"},et={class:"todoList_statistics"},d="https://todolist-api.hexschool.io",at={__name:"OnlineTodoListView",setup(h){const _=z(),a=document.cookie.replace(/(?:(?:^|.*;\s*)todolistToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");A(()=>{a?(k(),f()):(alert("請先登入"),_.push({path:"/login"}))});const m=i("貴賓"),k=async()=>{try{const e={headers:{Authorization:a}};await c.get(`${d}/users/checkout`,e).then(t=>{m.value=t.data.nickname})}catch(e){alert(`驗證失敗： ${e.message}`)}},l=async()=>{try{const e={headers:{Authorization:a}};await c.post(`${d}/users/sign_out`,{},e).then(t=>{alert(t.data.message),document.cookie="todolistToken=;Max-Age=-1;",_.push({path:"/login"})})}catch(e){console.log(e)}},n=i([]),g=i([]),f=async()=>{try{const e={headers:{Authorization:a}};await c.get(`${d}/todos`,e).then(t=>{console.log(t.data.data),n.value=t.data.data,p.value=n.value,g.value=t.data.data.filter(s=>s.status===!1).length})}catch(e){console.log(e)}},v=i(""),x=async()=>{const e=a;if(console.log(e),!v.value)return alert("請輸入待辦事項");if(!e)return alert("請先登入");try{const t={headers:{Authorization:e}};await c.post(`${d}/todos`,{content:v.value},t).then(s=>{console.log(s.data),v.value="",f()})}catch(t){console.log(t)}},C=async e=>{try{const t={headers:{Authorization:a}};await c.delete(`${d}/todos/${e}`,t).then(s=>{console.log(s.data),f()})}catch(t){alert(`刪除失敗 ${t.response.data.message}`),console.log(t)}},b=async e=>{g.value=n.value.filter(t=>t.status===!1).length;try{const t={headers:{Authorization:a}};await c.patch(`${d}/todos/${e}/toggle`,{},t).then(s=>{console.log(s.data),f()})}catch(t){console.log(t)}},y=i("all"),p=i([]),$=e=>{y.value=e,e==="all"?p.value=n.value:e==="pending"?p.value=n.value.filter(t=>t.status===!1):e==="completed"&&(p.value=n.value.filter(t=>t.status===!0))};return(e,t)=>(r(),u("div",I,[o("nav",null,[O,o("ul",null,[o("li",R,[o("a",null,[o("span",null,w(m.value)+"的代辦",1)])]),o("li",null,[o("a",{onClick:B(l,["prevent"]),style:{cursor:"pointer"}},"登出")])])]),o("div",X,[o("div",q,[o("div",G,[V(o("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s)},null,512),[[D,v.value]]),o("a",{onClick:x,style:{cursor:"pointer"}},J)]),n.value.length===0?(r(),u("div",K,Y)):L("",!0),n.value.length!==0?(r(),u("div",Z,[o("ul",tt,[o("li",null,[o("a",{class:T({active:y.value==="all"}),onClick:t[1]||(t[1]=s=>$("all"))},"全部",2)]),o("li",null,[o("a",{class:T({active:y.value==="pending"}),onClick:t[2]||(t[2]=s=>$("pending"))},"待完成",2)]),o("li",null,[o("a",{class:T({active:y.value==="completed"}),onClick:t[3]||(t[3]=s=>$("completed"))},"已完成",2)])]),o("div",ot,[(r(!0),u(F,null,M(p.value,s=>(r(),u("ul",{class:"todoList_item",key:s.id},[N(E,{content:s.content,status:s.status,id:s.id,onDeleteTodo:C,onFinishedTodo:b},null,8,["content","status","id"])]))),128)),o("div",et,[o("p",null,w(g.value)+" 個待完成項目",1)])])])):L("",!0)])])]))}};export{at as default};
