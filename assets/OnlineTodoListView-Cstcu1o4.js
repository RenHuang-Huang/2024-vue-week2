import{o as m,c as g,a as t,t as w,r as h,u as I,b as N,d as M,e as L,f as x,g as P,w as S,h as F,v as j,i as C,n as T,F as b,j as E}from"./index-Dn3eiJPz.js";import{s as l,a as n,L as J}from"./showAlert-CFaJzVdo.js";const O={class:"todoList_label"},R=["checked"],X=t("i",{class:"fa fa-times"},[t("button",{class:"deleteBtn"},"X")],-1),q=[X],G={__name:"TodoList",props:{content:String,status:Boolean,id:String},emits:["delete-todo","completed-todo"],setup(_,{emit:i}){const u=i,y=r=>{u("delete-todo",r)},k=r=>{u("completed-todo",r)};return(r,d)=>(m(),g("li",null,[t("label",O,[t("input",{class:"todoList_input",type:"checkbox",checked:_.status,onChange:d[0]||(d[0]=$=>k(_.id))},null,40,R),t("span",null,w(_.content),1)]),t("a",{onClick:d[1]||(d[1]=$=>y(_.id)),style:{height:"42px"}},q)]))}},H={id:"todoListPage",class:"bg-half"},K=t("a",{style:{width:"45%"}},[t("img",{class:"logoImg",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/logo.png",alt:"",style:{"max-width":"300px"}})],-1),Q={class:"todo_sm"},W={class:"conatiner todoListPage vhContainer"},Y={class:"todoList_Content"},Z={class:"inputBox"},tt=t("i",{class:"fa fa-plus"},"+",-1),et=[tt],st={key:0,class:"todoList_empty"},ot=t("p",null,"目前尚無待辦事項",-1),at=t("img",{src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/empty%201.png",alt:"",style:{width:"80%"}},null,-1),lt=[ot,at],nt={key:1,class:"todoList_list"},it={class:"todoList_tab"},rt={class:"todoList_items"},ct={class:"todoList_statistics"},v="https://todolist-api.hexschool.io",pt={__name:"OnlineTodoListView",setup(_){const i=h(!1),u=I();let y=document.cookie.replace(/(?:(?:^|.*;\s*)todolistToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");const k=h("");N(()=>{y?(n.defaults.headers.common.Authorization=y,d(),B(),k.value=setInterval(()=>{d()},6e4)):(l("錯誤","請先登入","error","確認"),u.push({path:"/login"}))}),M(()=>{clearInterval(k.value)});const r=h("貴賓"),d=async()=>{var e;try{n.defaults.headers.common.Authorization=document.cookie.replace(/(?:(?:^|.*;\s*)todolistToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");const s=await n.get(`${v}/users/checkout`);s.data.nickname.trim()!==""&&(r.value=s.data.nickname)}catch(s){n.defaults.headers.common.Authorization===""?(l("錯誤","Token遺失 請重新登入","error","確認"),u.push({path:"/login"})):(l("錯誤",(e=s.response)==null?void 0:e.data.message,"error","確認"),u.push({path:"/login"}))}},$=async()=>{try{i.value=!0;const e=await n.post(`${v}/users/sign_out`,{});l("成功",e.data.message,"success","確認"),document.cookie="todolistToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",u.push({path:"/login"})}catch(e){l("錯誤",e.response.data.message,"error","確認")}finally{i.value=!1}},a=h([]),B=async()=>{try{i.value=!0;const e=await n.get(`${v}/todos`);a.value=e.data.data}catch(e){l("錯誤",e.response.data.message,"error","確認")}finally{i.value=!1}},p=h(""),D=async()=>{if(!p.value.trim())return p.value="",l("錯誤","請輸入待辦事項","error","確認");try{const e=await n.post(`${v}/todos`,{content:p.value});p.value="",a.value.push(e.data.newTodo)}catch(e){l("錯誤",e.response.data.message,"error","確認")}},U=async e=>{var s;try{(s=(await n.delete(`${v}/todos/${e}`)).data)!=null&&s.status&&(a.value=a.value.filter(f=>f.id!==e))}catch(o){l("錯誤",o.response.data.message,"error","確認")}},V=async e=>{var s;try{(s=(await n.patch(`${v}/todos/${e}/toggle`,{})).data)!=null&&s.status&&a.value.filter(f=>{f.id===e&&(f.status=!f.status)})}catch(o){l("錯誤",o.response.data.message,"error","確認")}},z=L(()=>a.value.filter(e=>e.status===!1).length),c=h("all"),A=L(()=>c.value==="completed"?a.value.filter(e=>e.status):c.value==="pending"?a.value.filter(e=>!e.status):a.value);return(e,s)=>(m(),g(b,null,[x(P(J),{active:i.value,"onUpdate:active":s[0]||(s[0]=o=>i.value=o),"is-full-page":!0},null,8,["active"]),t("div",H,[t("nav",null,[K,t("ul",null,[t("li",Q,[t("a",null,[t("span",null,w(r.value?r.value:"貴賓")+"的代辦",1)])]),t("li",null,[t("a",{onClick:S($,["prevent"]),style:{cursor:"pointer"}},"登出")])])]),t("div",W,[t("div",Y,[t("div",Z,[F(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[1]||(s[1]=o=>p.value=o)},null,512),[[j,p.value]]),t("a",{onClick:D,style:{cursor:"pointer"}},et)]),a.value.length===0?(m(),g("div",st,lt)):C("",!0),a.value.length!==0?(m(),g("div",nt,[t("ul",it,[t("li",null,[t("a",{class:T({active:c.value==="all"}),onClick:s[2]||(s[2]=o=>c.value="all")}," 全部 ",2)]),t("li",null,[t("a",{class:T({active:c.value==="pending"}),onClick:s[3]||(s[3]=o=>c.value="pending")}," 待完成 ",2)]),t("li",null,[t("a",{class:T({active:c.value==="completed"}),onClick:s[4]||(s[4]=o=>c.value="completed")}," 已完成 ",2)])]),t("div",rt,[(m(!0),g(b,null,E(A.value,o=>(m(),g("ul",{class:"todoList_item",key:o.id},[x(G,{content:o.content,status:o.status,id:o.id,onDeleteTodo:U,onCompletedTodo:V},null,8,["content","status","id"])]))),128)),t("div",ct,[t("p",null,w(z.value)+" 個待完成項目",1)])])])):C("",!0)])])])],64))}};export{pt as default};
