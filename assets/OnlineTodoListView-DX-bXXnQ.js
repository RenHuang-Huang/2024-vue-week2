import{o as m,c as g,a as t,t as w,r as p,u as M,b as N,d as U,e as L,f as C,g as P,w as S,h as F,v as j,i as x,n as T,F as b,j as E}from"./index-BQWmnsWE.js";import{s as l,a as n,L as O}from"./showAlert-BMVvtiEe.js";const R={class:"todoList_label"},X=["checked"],q=t("i",{class:"fa fa-times"},[t("button",{class:"deleteBtn"},"X")],-1),G=[q],H={__name:"TodoList",props:{content:String,status:Boolean,id:String},emits:["delete-todo","completed-todo"],setup(_,{emit:i}){const d=i,f=r=>{d("delete-todo",r)},y=r=>{d("completed-todo",r)};return(r,c)=>(m(),g("li",null,[t("label",R,[t("input",{class:"todoList_input",type:"checkbox",checked:_.status,onChange:c[0]||(c[0]=k=>y(_.id))},null,40,X),t("span",null,w(_.content),1)]),t("a",{onClick:c[1]||(c[1]=k=>f(_.id)),style:{height:"42px"}},G)]))}},J={id:"todoListPage",class:"bg-half"},K=t("a",null,[t("img",{class:"logoImg",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/logo.png",alt:"",style:{width:"45%"}})],-1),Q={class:"todo_sm"},W={class:"conatiner todoListPage vhContainer"},Y={class:"todoList_Content"},Z={class:"inputBox"},tt=t("i",{class:"fa fa-plus"},"+",-1),et=[tt],st={key:0,class:"todoList_empty"},ot=t("p",null,"目前尚無待辦事項",-1),at=t("img",{src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/empty%201.png",alt:"",style:{width:"80%"}},null,-1),lt=[ot,at],nt={key:1,class:"todoList_list"},it={class:"todoList_tab"},rt={class:"todoList_items"},ut={class:"todoList_statistics"},v="https://todolist-api.hexschool.io",ht={__name:"OnlineTodoListView",setup(_){const i=p(!1),d=M();let f=document.cookie.replace(/(?:(?:^|.*;\s*)todolistToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");const y=p("");N(()=>{f?(n.defaults.headers.common.Authorization=f,c(),B(),y.value=setInterval(()=>{c()},6e4)):(l("錯誤","請先登入","error","確認"),d.push({path:"/login"}))}),U(()=>{clearInterval(y.value)});const r=p("貴賓"),c=async()=>{var e;try{n.defaults.headers.common.Authorization=document.cookie.replace(/(?:(?:^|.*;\s*)todolistToken\s*\=\s*([^;]*).*$)|^.*$/,"$1"),await n.get(`${v}/users/checkout`).then(s=>{s.data.nickname.trim()!==""&&(r.value=s.data.nickname)})}catch(s){console.log(s.response),n.defaults.headers.common.Authorization===""?(l("錯誤","Token遺失 請重新登入","error","確認"),d.push({path:"/login"})):(l("錯誤",(e=s.response)==null?void 0:e.data.message,"error","確認"),d.push({path:"/login"}))}},k=async()=>{try{i.value=!0,await n.post(`${v}/users/sign_out`,{}).then(e=>{l("成功",e.data.message,"success","確認"),document.cookie="todolistToken=;Max-Age=-1;",d.push({path:"/login"})})}catch(e){l("錯誤",e.response.data.message,"error","確認")}finally{i.value=!1}},a=p([]),B=async()=>{try{i.value=!0,await n.get(`${v}/todos`).then(e=>{a.value=e.data.data})}catch(e){l("錯誤",e.response.data.message,"error","確認")}finally{i.value=!1}},h=p(""),A=async()=>{if(!h.value.trim())return h.value="",l("錯誤","請輸入待辦事項","error","確認");try{await n.post(`${v}/todos`,{content:h.value}).then(e=>{h.value="",a.value.push(e.data.newTodo)})}catch(e){l("錯誤",e.response.data.message,"error","確認")}},D=async e=>{try{await n.delete(`${v}/todos/${e}`).then(s=>{s.data.status&&(a.value=a.value.filter(o=>o.id!==e))})}catch(s){l("錯誤",s.response.data.message,"error","確認")}},V=async e=>{try{await n.patch(`${v}/todos/${e}/toggle`,{}).then(s=>{var o;(o=s.data)!=null&&o.status&&a.value.filter($=>{$.id===e&&($.status=!$.status)})})}catch(s){l("錯誤",s.response.data.message,"error","確認")}},z=L(()=>a.value.filter(e=>e.status===!1).length),u=p("all"),I=L(()=>u.value==="completed"?a.value.filter(e=>e.status):u.value==="pending"?a.value.filter(e=>!e.status):a.value);return(e,s)=>(m(),g(b,null,[C(P(O),{active:i.value,"onUpdate:active":s[0]||(s[0]=o=>i.value=o),"is-full-page":!0},null,8,["active"]),t("div",J,[t("nav",null,[K,t("ul",null,[t("li",Q,[t("a",null,[t("span",null,w(r.value?r.value:"貴賓")+"的代辦",1)])]),t("li",null,[t("a",{onClick:S(k,["prevent"]),style:{cursor:"pointer"}},"登出")])])]),t("div",W,[t("div",Y,[t("div",Z,[F(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[1]||(s[1]=o=>h.value=o)},null,512),[[j,h.value]]),t("a",{onClick:A,style:{cursor:"pointer"}},et)]),a.value.length===0?(m(),g("div",st,lt)):x("",!0),a.value.length!==0?(m(),g("div",nt,[t("ul",it,[t("li",null,[t("a",{class:T({active:u.value==="all"}),onClick:s[2]||(s[2]=o=>u.value="all")},"全部",2)]),t("li",null,[t("a",{class:T({active:u.value==="pending"}),onClick:s[3]||(s[3]=o=>u.value="pending")},"待完成",2)]),t("li",null,[t("a",{class:T({active:u.value==="completed"}),onClick:s[4]||(s[4]=o=>u.value="completed")},"已完成",2)])]),t("div",rt,[(m(!0),g(b,null,E(I.value,o=>(m(),g("ul",{class:"todoList_item",key:o.id},[C(H,{content:o.content,status:o.status,id:o.id,onDeleteTodo:D,onCompletedTodo:V},null,8,["content","status","id"])]))),128)),t("div",ut,[t("p",null,w(z.value)+" 個待完成項目",1)])])])):x("",!0)])])])],64))}};export{ht as default};
